<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>CryptoArchaeologist - Mobile Mine</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    background: linear-gradient(135deg, #2e2b27, #1b1916);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
    user-select: none;
  }
  #mine {
    position: relative;
    width: 100vw;
    height: 100vh;
    background: #3a362f url('https://i.imgur.com/MC97U6J.jpg') center bottom / cover no-repeat;
    touch-action: manipulation;
  }
  #walls {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 80%;
    background: url('https://i.imgur.com/3D3FvYV.jpg') center center / cover no-repeat;
    filter: brightness(0.7);
    z-index: 1;
  }
  #floor {
    position: absolute;
    bottom: 0; left: 0; width: 100%; height: 20%;
    background: url('https://i.imgur.com/8n8tBvD.jpg') center center / cover no-repeat;
    filter: brightness(0.6);
    z-index: 2;
  }
  #pickaxe {
    position: absolute;
    bottom: 25%;
    left: 50%;
    width: 80px;
    height: 80px;
    background: url('https://i.imgur.com/ot9u1uI.png') center center / contain no-repeat;
    transform-origin: 20% 80%;
    z-index: 3;
    will-change: transform;
  }
  #artifact {
    position: absolute;
    bottom: 45%;
    left: 50%;
    width: 60px;
    height: 60px;
    background-size: contain;
    background-repeat: no-repeat;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity 0.4s ease-in-out;
    z-index: 4;
  }
  #artifact-name {
    position: absolute;
    bottom: 35%;
    left: 50%;
    color: #ccf;
    font-weight: 600;
    text-shadow: 0 0 4px #000;
    transform: translateX(-50%);
    z-index: 5;
    opacity: 0;
    transition: opacity 0.4s ease-in-out;
  }
  #exit-btn {
    position: absolute;
    top: 30px;
    right: 20px;
    padding: 12px 18px;
    background: #444;
    color: #eee;
    font-weight: 600;
    border-radius: 10px;
    box-shadow: 0 0 10px #222 inset;
    user-select: none;
    z-index: 10;
  }
  #exit-btn:active {
    background: #666;
  }
</style>
</head>
<body>
  <div id="mine">
    <div id="walls"></div>
    <div id="floor"></div>
    <div id="pickaxe"></div>
    <div id="artifact"></div>
    <div id="artifact-name"></div>
    <button id="exit-btn">Exit to Menu</button>
  </div>

<script>
  const pickaxe = document.getElementById('pickaxe');
  const artifact = document.getElementById('artifact');
  const artifactName = document.getElementById('artifact-name');
  const exitBtn = document.getElementById('exit-btn');

  let artifactsList = [];

  // Загружаем артефакты с сервера
  async function loadArtifacts() {
    try {
      const res = await fetch('/artifacts');
      const data = await res.json();
      // Объединяем все уровни артефактов в один массив
      artifactsList = [
        ...data.common,
        ...data.uncommon,
        ...data.rare,
        ...data.superrare,
        ...data.epic,
        ...data.superepic,
        ...data.legendary
      ];
      // Для артефактов без картинок добавим плейсхолдер
      artifactsList = artifactsList.map(a => ({
        name: a.name,
        image: a.image || 'https://via.placeholder.com/60?text=?',
        value: a.value || 0
      }));
    } catch (e) {
      console.error('Failed to load artifacts', e);
    }
  }

  let swinging = false;

  function swingPickaxe() {
    if (swinging) return;
    swinging = true;

    // Анимация взмаха кирки
    pickaxe.style.transition = "transform 0.25s ease-in-out";
    pickaxe.style.transform = "rotate(45deg)";
    setTimeout(() => {
      pickaxe.style.transform = "rotate(0deg)";
    }, 250);

    // Показать случайный артефакт
    if (artifactsList.length === 0) {
      swinging = false;
      return;
    }

    const found = artifactsList[Math.floor(Math.random() * artifactsList.length)];

    artifact.style.backgroundImage = `url(${found.image})`;
    artifactName.textContent = found.name;
    artifact.style.opacity = "1";
    artifactName.style.opacity = "1";

    // Скрыть артефакт и название через 1.5 секунды
    setTimeout(() => {
      artifact.style.opacity = "0";
      artifactName.style.opacity = "0";
      swinging = false;
    }, 1500);
  }

  // Обработчик клика по шахте (не мешаем кнопке выхода)
  document.getElementById('mine').addEventListener('click', e => {
    if (e.target === exitBtn) return;
    swingPickaxe();
  });

  exitBtn.addEventListener('click', () => {
    window.location.href = '/'; // Возврат на главную
  });

  loadArtifacts();
</script>
</body>
</html>
